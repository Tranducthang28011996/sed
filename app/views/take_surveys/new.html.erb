<% unless survey_completed?(current_user, @survey) %>
  <%= title "Taking Survey: #{@survey.name}" %>
  <%= markdown "###{yield(:title)}" %>
  <%= form_tag take_surveys_path, :method => :post do %>
    <ol>
    <% @survey.questions.each do |question| %>
      <% if current_user.responses.find_by_question_id(question.id).nil? %>
      <%= content_tag(:li, label_tag(:question, question.content)) %>
      <ol>
      <% question.answers.each do |answer| %>
        <%= content_tag_for(:li, answer) do %>
          <% unless current_user.responses.find_by_question_id_and_answer_id(question.id, answer.id).nil? %>
            <span class="my-response">
              <%= radio_button_tag "response[#{question.id}]", "#{answer.id}", :checked => true %>
              <%= label_tag :answer, answer.content %>
            </span>
          <% else %>
            <%= radio_button_tag "response[#{question.id}]", "#{answer.id}" %>
            <%= label_tag :answer, answer.content %>
          <% end %>
        <% end %>
      <% end %>
      </ol>
      <br />
      <% else %>
        You have already answered :
        <%= label_tag :question, question.content %><br /><br />
      <% end %>
      <%= hidden_field_tag :survey_id, @survey.id %>
    <% end %>
    </ol>
    <div class="field">
      <%= submit_tag "Submit My Answers" %>
    </div>
  <% end %>
<% else %>
  <%= title "Survey Completed: #{@survey.name}" %>
  <%= markdown "###{yield(:title)}" %>
  <div class="center">
    <%= markdown "# You have already completed this survey." %>
  </div>
<% end %>
